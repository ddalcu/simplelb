services:
  simple-lb:
    build: .
    ports:
      - "80:80" # HTTP traffic
      - "443:443" # HTTPS traffic
      - "81:81" # Management web interface (HTTPS)
      - "2019:2019" # Caddy Admin API (for debugging)
    environment:
      # Management Interface Authentication
      - ADMIN_USERNAME=admin
      - ADMIN_PASSWORD=password
      - MANAGEMENT_PORT=81

      # Security Configuration
      - SESSION_SECRET=your-super-secret-session-key-change-this-in-production
      - SESSION_COOKIE_SECURE=0 # Set to 1 for HTTPS in production

      # Rate Limiting Configuration (requests per minute)
      - GENERAL_RATE_LIMIT=60 # All endpoints (60/min)

      # Load balancer listens on both HTTP (80) and HTTPS (443) by default

      # Caddy Integration
      - CADDY_ADMIN_URL=http://127.0.0.1:2019 # Caddy Admin API URL

      # Configuration Management
      - CONFIG_MODE=initial # "initial" (default, update via UI) or "managed" (cannot be changed by UI)

      # Environment-based Load Balancer Configuration (optional)
      # Uncomment and configure as needed:

      # Load Balancer Example: API Service
      # - LB_DOMAINS_api=api.example.com,www.api.example.com
      # - LB_BACKENDS_api=api.github.com:443,jsonplaceholder.typicode.com:443
      # - LB_METHOD_api=round_robin

      # Load Balancer Example: Web Application
      # - LB_DOMAINS_webapp=app.example.com
      # - LB_BACKENDS_webapp=api.github.com:443,jsonplaceholder.typicode.com:443
      # - LB_METHOD_webapp=least_conn

      # Load Balancer Example: Admin Interface
      # - LB_DOMAINS_admin=admin.example.com
      # - LB_BACKENDS_admin=192.168.1.150:9000
      # - LB_METHOD_admin=random
    volumes:
      - ./data:/app/data
    restart: unless-stopped
